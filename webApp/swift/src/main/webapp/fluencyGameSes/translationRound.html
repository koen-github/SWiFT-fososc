<lift:surround with="default" at="content">

<h1>Translation Round</h1>

<lift:TranslationRound form="POST">
<center>
   <lift:createProgress.text />
</center>
<Br/>

<transround:reviewModeMessage /> <!-- TODO: make separate snippet to render this one, so that it can be reused in all applicable rounds -->

<hr />
<h3>Source</h3>
<transround:sourceText /><br /><br />
<hr /><br />
<h3>Translation</h3>
<br />
<center>
<i>Total translation time </i><Br/></center>
<div id="timeBox"></div>
<div id="time" style="display:none;"><form:startTime /></div>
<script type="text/javascript">
    // <![CDATA[
    function keyLogData(){
    function saveData(key, pos){

    var param = encodeURI(key)
    var div = document.getElementById("output_data_keys")
    div.value = div.value +

    "{\"key\" : \"" + param + "\",\"time\" : "+(new Date).getTime()+ ", \"pos\" : "+pos+ "},";
                                            }
          document.onkeypress = function(evt) {
             evt = evt || window.event
             key = String.fromCharCode(evt.charCode)
             if (key) {
             var posi = $('#inp').prop('selectionStart')
                 saveData(key, posi);
                 console.log(key)
             }


         }
          $(document).keydown(function(e){

           if(e.keyCode == 8 || e.keyCode == 46)
           {
           var key = String.fromCharCode(e.keyCode);
           var posi = $('#inp').prop('selectionStart')
           console.log(e.keyCode);
           saveData(key, posi);
           }
          });

          $('#inp').select( function() {
            var textComponent = document.getElementById('inp');
             var selectedText;
           // IE version
             if (document.selection != undefined)
             {
              textComponent.focus();
              var sel = document.selection.createRange();
              selectedText = sel.text;
             }
            // Mozilla version
          else if (textComponent.selectionStart != undefined)
            {
              var startPos = textComponent.selectionStart;
              var endPos = textComponent.selectionEnd;
              selectedText = textComponent.value.substring(startPos, endPos)
            }
              console.log("Selected text: " + selectedText + " Startpos: "+startPos + " EndPos: "+ endPos);

          var div = document.getElementById("output_data_selections")
          div.value = div.value +

         "{\"start\" : " + startPos + ", \"end\" : " + endPos + ", \"selText\" : \"" + selectedText + "\", \"time\" : "+(new Date).getTime()+ "},";

        });


         }
    // ]]>
</script>
<form:keylogData/>
<form:keylogSelections/>
<script type="text/javascript">

	//USING EPOCH TIME -- tested in CHROME and FIREFOX//

    var prevTime = document.getElementById('time').innerHTML;
	function countSecs() {
		 //prevTime = curTime;
		curTime = +new Date();
		
 

var deltaTime = curTime - prevTime;
var seconds = deltaTime.toString().substring(0, deltaTime.toString().length-3);
var millis = deltaTime.toString().substring(deltaTime.toString().length-3, deltaTime.toString().length-2);
console.log(prevTime);
		document.getElementById('timeBox').innerHTML = '<center> <h3> ' + seconds+ '.'+millis+'</h3></center>';
 		}


     window.setInterval(countSecs,100);
 

</script>

<br />
<p>No idea what to do? Continue studying the constitution by clicking "Consti Study" in the menu above!</p>
<form:translation /><br />
<form:testTransBt />
<pre>
<form:errorTrans />
</pre>
<!-- <button>test grammatically</button><br /> -->
<br />
<br />
<hr />
<form:submitBt />
</lift:TranslationRound>
<br /><br />

</lift:surround>
